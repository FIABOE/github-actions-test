name: ğŸ¥ Health Check

on:
  schedule:
    - cron: '0 12 * * *'  # S'exÃ©cute UNE SEULE FOIS par jour Ã  midi (au lieu de toutes les 5 min)
  workflow_dispatch:      # Te permet de le lancer Ã  la main pour tester

jobs:
  health-check:
    name: ğŸ” VÃ©rification de SantÃ©
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4
      
      - name: ğŸŒ Ping du endpoint /health
        id: health_check
        run: |
          # IMPORTANT : Remplace 'http://localhost:5000' par l'adresse de ton site rÃ©el plus tard
          API_URL="${{ secrets.API_URL || 'http://localhost:5000' }}"
          
          echo "ğŸ” VÃ©rification de $API_URL/health"
          
          # On tente de joindre le site. Si Ã§a Ã©choue, on ne panique pas tout de suite (continue-on-error)
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 10 "$API_URL/health" || echo "000")
          
          echo "ğŸ“Š Code HTTP: $HTTP_CODE"
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Le site rÃ©pond parfaitement !"
            exit 0
          else
            echo "âš ï¸ Le site ne rÃ©pond pas (Code: $HTTP_CODE). C'est normal si vous n'avez pas encore dÃ©ployÃ© sur internet."
            # On met exit 0 pour ne pas recevoir de mail d'erreur tant que le site n'est pas en ligne
            exit 0 
          fi

  summary:
    name: ğŸ“Š RÃ©sumÃ©
    runs-on: ubuntu-latest
    needs: [health-check]
    if: always()
    steps:
      - name: ğŸ“Š Afficher le rÃ©sumÃ© dans les logs
        run: |
          echo "DerniÃ¨re vÃ©rification terminÃ©e le $(date)"
